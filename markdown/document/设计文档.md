# 工单管理系统设计文档

## 1. 系统架构设计

### 1.1 整体架构
本系统采用前后端分离的架构模式，前端使用Vue 3框架，后端提供RESTful API接口。

```
┌─────────────────┐    HTTP/HTTPS    ┌─────────────────┐
│   前端应用       │ ←──────────────→  │   后端服务       │
│  (Vue 3)        │                  │  (RESTful API)  │
└─────────────────┘                  └─────────────────┘
                                              │
                                              ▼
                                     ┌─────────────────┐
                                     │   数据库         │
                                     │  (MySQL)        │
                                     └─────────────────┘
```

### 1.2 前端架构
前端采用模块化设计，主要包含以下模块：

```
src/
├── api/                    # API接口封装
│   ├── user.js            # 用户相关接口
│   ├── workorder.js       # 工单相关接口
│   ├── flow.js           # 工作流相关接口
│   ├── admin.js          # 权限相关接口
│   └── dashboard.js      # 工作台相关接口
├── router/               # 路由配置
│   └── index.js         # 路由定义
├── stores/               # 状态管理
│   └── user.js          # 用户状态
├── utils/                # 工具函数
│   └── request.js       # HTTP请求封装
├── views/                # 页面组件
│   ├── Login.vue        # 登录页面
│   ├── Layout.vue       # 用户退出，修改信息，查看信息页面
│   ├── Dashboard.vue    # 仪表板
│   ├── workorder/       # 工单管理
│   ├── approval/        # 工单审批
│   ├── dispatch/        # 工单分派
│   ├── todo/            # 工单处理
│   ├── confirm/         # 工单确认
│   ├── system/          # 系统权限管理
│   └── statistics/      # 统计分析
├── App.vue              # 根组件
└── main.js              # 入口文件
```

### 1.3 技术栈详细说明

#### 1.3.1 核心框架
- **Vue 3.3.8**: 采用Composition API，提供更好的TypeScript支持和性能优化
- **Vite 5.0.0**: 现代化的构建工具，提供快速的开发体验

#### 1.3.2 UI组件库
- **Element Plus 2.4.2**: 基于Vue 3的组件库，提供丰富的UI组件
- **ECharts 5.4.3**: 数据可视化图表库

#### 1.3.3 状态管理
- **Pinia 2.1.7**: Vue 3的官方状态管理库，替代Vuex

#### 1.3.4 路由管理
- **Vue Router 4.2.5**: Vue 3的官方路由管理器

#### 1.3.5 工具库
- **Axios 1.6.2**: HTTP客户端，用于API请求
- **Vue Draggable 4.1.0**: 拖拽组件，用于工作流配置

## 2. 数据库设计

### 2.1 数据库表结构

#### 2.1.1 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    staff_number VARCHAR(50) UNIQUE NOT NULL COMMENT '工号',
    name VARCHAR(100) NOT NULL COMMENT '姓名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    company_code VARCHAR(50) COMMENT '公司代码',
    company VARCHAR(100) COMMENT '公司名称',
    department_code VARCHAR(50) COMMENT '部门代码',
    department VARCHAR(100) COMMENT '部门名称',
    position VARCHAR(100) COMMENT '职位',
    status TINYINT DEFAULT 0 COMMENT '状态：0正常，1休假，2停职，3离职',
    manager_number VARCHAR(50) COMMENT '直属领导工号',
    manager_name VARCHAR(100) COMMENT '直属领导姓名',
    phone VARCHAR(20) COMMENT '电话号码',
    email VARCHAR(100) COMMENT '邮箱',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 2.1.2 工单表 (workorders)
```sql
CREATE TABLE workorders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL COMMENT '工单标题',
    content TEXT COMMENT '工单内容',
    type TINYINT NOT NULL COMMENT '工单类型：1维修，2安装，3咨询，4其他',
    priority TINYINT DEFAULT 1 COMMENT '优先级：1低，2中，3高，4紧急',
    status TINYINT DEFAULT 1 COMMENT '状态：1待分配，2待审批，3处理中，4待验收，5已完成，6已拒绝',
    submitter_id BIGINT NOT NULL COMMENT '提交人ID',
    submitter_name VARCHAR(100) COMMENT '提交人姓名',
    flow_id BIGINT COMMENT '工作流ID',
    deadline_time BIGINT COMMENT '截止时间',
    accessory_name VARCHAR(255) COMMENT '附件名称',
    accessory_url VARCHAR(500) COMMENT '附件URL',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 2.1.3 工作流表 (workflows)
```sql
CREATE TABLE workflows (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    flow_name VARCHAR(100) NOT NULL COMMENT '工作流名称',
    description TEXT COMMENT '工作流描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用，0禁用',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 2.1.4 工作流节点表 (workflow_nodes)
```sql
CREATE TABLE workflow_nodes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    flow_id BIGINT NOT NULL COMMENT '工作流ID',
    node_type TINYINT NOT NULL COMMENT '节点类型：2审批，3指派，5验收',
    handler_id BIGINT NOT NULL COMMENT '处理人ID',
    handler_name VARCHAR(100) COMMENT '处理人姓名',
    sort_order INT DEFAULT 0 COMMENT '排序',
    is_last_node BOOLEAN DEFAULT FALSE COMMENT '是否为最后一个节点',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.1.5 处理记录表 (handle_records)
```sql
CREATE TABLE handle_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    workorder_id BIGINT NOT NULL COMMENT '工单ID',
    user_id BIGINT NOT NULL COMMENT '处理人ID',
    user_name VARCHAR(100) COMMENT '处理人姓名',
    department_name VARCHAR(100) COMMENT '部门名称',
    handle_type TINYINT NOT NULL COMMENT '处理类型：1提交，2审批，3指派，4处理，5验收',
    handle_result TINYINT COMMENT '处理结果：1通过，2拒绝',
    remark TEXT COMMENT '备注',
    handle_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2.2 数据库关系图
```
users (用户表)
├── 1:N → workorders (工单表)
├── 1:N → workflow_nodes (工作流节点表)
└── 1:N → handle_records (处理记录表)

workflows (工作流表)
└── 1:N → workflow_nodes (工作流节点表)

workorders (工单表)
├── N:1 → workflows (工作流表)
└── 1:N → handle_records (处理记录表)
```

## 3. 接口设计

### 3.1 接口规范

#### 3.1.1 请求格式
- 请求方法：POST/GET/PUT/DELETE
- 请求头：Content-Type: application/json
- 认证方式：Bearer Token

#### 3.1.2 响应格式
```json
{
    "code": 0,
    "msg": "success",
    "data": {}
}
```

#### 3.1.3 分页格式
```json
{
    "records": [],
    "total": 100,
    "size": 10,
    "current": 1,
    "pages": 10
}
```

### 3.2 核心接口设计

#### 3.2.1 用户认证接口
```javascript
// 用户登录
POST /user/login
Request: {
    "staffNumber": "string",
    "phone": "string", 
    "password": "string"
}
Response: {
    "code": 0,
    "msg": "success",
    "data": {
        "token": "string",
        "userInfo": {}
    }
}

// 获取个人信息
POST /user/me
Response: {
    "code": 0,
    "msg": "success", 
    "data": {
        "id": 1,
        "name": "张三",
        "department": "技术部",
        // ...其他用户信息
    }
}
```
表名: message
| 字段名      | 类型    | 描述               |
| :---------- | :------ | :----------------- |
| id          | bigint  | 消息ID，主键，自增 |
| receiver_id | bigint  | 接收者ID           |
| sender_id   | bigint  | 发送者ID           |
| type        | int     | 消息类型           |
| content     | text    | 消息内容           |
| send_time   | bigint  | 发送时间（时间戳） |
| deleted     | tinyint | 删除标志，默认为0  |


表名: company
| 字段名              | 类型         | 描述                         |
| :------------------ | :----------- | :--------------------------- |
| id                  | bigint       | 公司ID，主键，自增           |
| name                | varchar(100) | 公司名称                     |
| code                | varchar(50)  | 公司代码，唯一标识           |
| parent_company_code | varchar(50)  | 父公司代码，用于构建层级关系 |
| level               | tinyint      | 公司层级，默认为1            |
| create_time         | bigint       | 创建时间（时间戳）           |
| update_time         | bigint       | 更新时间（时间戳）           |

#### 3.2.2 工单管理接口
```javascript
// 创建工单
POST /workorder/create
Request: {
    "title": "string",
    "content": "string",
    "type": 1,
    "priority": 2,
    "flowId": 1,
    "deadlineTime": 1640995200000
}

// 分页查询工单
POST /workorder/page
Request: {
    "pageNum": 1,
    "pageSize": 10,
    "status": 1,
    "type": 1
}

// 获取工单详情
POST /workorder/detail
Request: {
    "id": 1
}
```

#### 3.2.3 工作流管理接口
```javascript
// 创建工作流
POST /flow/create
Request: {
    "flowName": "string",
    "nodes": [
        {
            "handlerId": 1,
            "handlerName": "张三",
            "nodeType": 2
        }
    ],
    "distributeNode": {
        "handlerId": 2,
        "handlerName": "李四"
    },
    "checkNode": {
        "handlerId": 3,
        "handlerName": "王五"
    }
}
```

## 4. 前端设计

### 4.1 页面布局设计

#### 4.1.1 整体布局
采用经典的侧边栏+主内容区布局：
- 顶部：Logo、用户信息、通知
- 左侧：导航菜单
- 主区域：页面内容
- 响应式设计，支持移动端

#### 4.1.2 组件设计原则
- 组件化开发，提高代码复用性
- 单一职责原则，每个组件只负责一个功能
- 可配置化，支持通过props进行配置
- 响应式设计，适配不同屏幕尺寸

### 4.2 核心页面设计

#### 4.2.1 登录页面
- 简洁的登录表单
- 支持工号/手机号登录
- 表单验证和错误提示
- 记住密码功能

#### 4.2.2 仪表板页面
- 数据概览卡片
- 快捷操作按钮
- 待办事项列表
- 统计图表展示

#### 4.2.3 工单管理页面
- 工单列表（支持搜索、筛选、分页）
- 工单创建表单
- 工单详情页面
- 工单处理界面

#### 4.2.4 工作流配置页面
- 工作流列表
- 工作流设计器（拖拽式）
- 节点配置表单
- 工作流预览

### 4.3 交互设计

#### 4.3.1 用户体验设计
- 加载状态提示
- 操作成功/失败反馈
- 表单验证提示
- 确认对话框

#### 4.3.2 响应式设计
- 桌面端：1200px+
- 平板端：768px-1199px
- 手机端：<768px

#### 4.3.3 主题设计
- 主色调：#409EFF（蓝色）
- 成功色：#67C23A（绿色）
- 警告色：#E6A23C（橙色）
- 危险色：#F56C6C（红色）

## 5. 安全设计

### 5.1 认证授权
- JWT Token认证
- 路由守卫
- 权限控制
- 会话管理

### 5.2 数据安全
- 密码加密存储
- 敏感信息脱敏
- 输入验证和过滤
- XSS防护

### 5.3 接口安全
- 请求频率限制
- 参数验证
- 错误信息处理
- HTTPS传输

## 6. 性能优化

### 6.1 前端优化
- 路由懒加载
- 组件按需加载
- 图片懒加载
- 代码分割

### 6.2 构建优化
- Vite构建优化
- 依赖包优化
- 静态资源压缩
- CDN加速

### 6.3 缓存策略
- 浏览器缓存
- API响应缓存
- 静态资源缓存
- 数据缓存

## 7. 部署方案

### 7.1 开发环境
- 本地开发服务器
- 热重载
- 调试工具
- 代码格式化

### 7.2 生产环境
- Nginx服务器
- HTTPS配置
- 静态资源压缩
- 错误页面配置

### 7.3 监控方案
- 错误监控
- 性能监控
- 用户行为分析
- 日志收集 